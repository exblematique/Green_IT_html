<?php session_start();if(isset($_SESSION["loggedin"])&&$_SESSION["loggedin"]===true){header("location: welcome.php");exit;}function dc(){session_destroy();header("location: accueil.php");}require_once "META-INF/config.php";$Username=$Password="";$Username_err=$Password_err="";if($_SERVER["REQUEST_METHOD"]=="POST"){if(empty(trim($_POST["Username"]))){session_destroy();header("location: accueil.php");}else{$Username=trim($_POST["Username"]);}if(empty(trim($_POST["Password"]))){session_destroy();header("location: accueil.php");}else{$Password=trim($_POST["Password"]);}if(empty($Username_err)&&empty($Password_err)){$sql="SELECT ID, Username, Foyer, Password, Email , Actif , SHA1(?) FROM Account WHERE Username = ?";if($stmt=mysqli_prepare($link,$sql)){mysqli_stmt_bind_param($stmt,"ss",$Password,$param_Username);$param_Username=$Username;if(mysqli_stmt_execute($stmt)){mysqli_stmt_store_result($stmt);if(mysqli_stmt_num_rows($stmt)==1){mysqli_stmt_bind_result($stmt,$id,$Username,$Foyer,$stored_Password,$email,$actif,$hashed_Password);if(mysqli_stmt_fetch($stmt)){if($actif===1){if($stored_Password===$hashed_Password){session_start();$_SESSION["loggedin"]=true;$_SESSION["Email"]=$email;$_SESSION["ID"]=$id;$_SESSION["Username"]=$Username;if($Username=="D4G2019"){header("location: admin_view.php");}else{$_SESSION["Foyer"]=$Foyer;header("location: welcome.php");}}else{dc();};}else{dc();};}else{dc();};}else{dc();};}else{dc();};}else{dc();};}else{dc();};} ?>